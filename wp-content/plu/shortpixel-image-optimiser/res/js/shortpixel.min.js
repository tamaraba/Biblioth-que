jQuery(document).ready(function(){ShortPixel.init()});var ShortPixel=function(){function N(){if(typeof ShortPixel.API_KEY!=="undefined"){return}if(jQuery("table.wp-list-table.media").length>0){jQuery('select[name^="action"] option:last-child').before('<option value="short-pixel-bulk">'+_spTr.optimizeWithSP+'</option><option value="short-pixel-bulk-lossy"> → '+_spTr.redoLossy+'</option><option value="short-pixel-bulk-glossy"> → '+_spTr.redoGlossy+'</option><option value="short-pixel-bulk-lossless"> → '+_spTr.redoLossless+'</option><option value="short-pixel-bulk-restore"> → '+_spTr.restoreOriginal+"</option>")}ShortPixel.setOptions(ShortPixelConstants[0]);if(jQuery("#backup-folder-size").length){jQuery("#backup-folder-size").html(ShortPixel.getBackupSize())}if(ShortPixel.MEDIA_ALERT=="todo"&&jQuery("div.media-frame.mode-grid").length>0){jQuery("div.media-frame.mode-grid").before('<div id="short-pixel-media-alert" class="notice notice-warning"><p>'+SPstringFormat(_spTr.changeMLToListMode,'<a href="upload.php?mode=list" class="view-list"><span class="screen-reader-text">'," </span>",'</a><a class="alignright" href="javascript:ShortPixel.dismissMediaAlert();">',"</a>")+"</p></div>")}jQuery(window).on("beforeunload",function(){if(ShortPixel.bulkProcessor==true){clearBulkProcessor()}});checkQuotaExceededAlert();checkBulkProgress()}function o(V){for(var W in V){ShortPixel[W]=V[W]}}function x(V){return/^\w+([\.+-]?\w+)*@\w+([\.-]?\w+)*(\.\w{1,63})+$/.test(V)}function p(){var V=jQuery("#pluginemail").val();if(ShortPixel.isEmailValid(V)){jQuery("#request_key").removeClass("disabled")}jQuery("#request_key").attr("href",jQuery("#request_key").attr("href").split("?")[0]+"?pluginemail="+V)}function a(V){console.log("validate");jQuery("#valid").val("validate");jQuery(V).parents("form").submit()}jQuery("#key").keypress(function(V){if(V.which==13){jQuery("#valid").val("validate")}});function Q(V){if(jQuery(V).is(":checked")){jQuery("#width,#height").removeAttr("disabled")}else{jQuery("#width,#height").attr("disabled","disabled")}}function k(){if(!jQuery('input[name="removeExif"]').is(":checked")&&jQuery('input[name="png2jpg"]').is(":checked")){jQuery(".exif_warning").fadeIn()}else{jQuery(".exif_warning").fadeOut()}}function e(){var V=0;if(typeof document.wp_shortpixel_options!=="undefined"){V=document.wp_shortpixel_options.compressionType}for(var W=0,X=null;W<V.length;W++){V[W].onclick=function(){if(this!==X){X=this}if(typeof ShortPixel.setupGeneralTabAlert!=="undefined"){return}alert(_spTr.alertOnlyAppliesToNewImages);ShortPixel.setupGeneralTabAlert=1}}ShortPixel.enableResize("#resize");jQuery("#resize").change(function(){Q(this)});jQuery(".resize-sizes").blur(function(aa){var ab=jQuery(aa.target);if(ShortPixel.resizeSizesAlert==ab.val()){return}ShortPixel.resizeSizesAlert=ab.val();var Z=jQuery("#min-"+ab.attr("name")).val();var Y=jQuery("#min-"+ab.attr("name")).data("nicename");if(ab.val()<Math.min(Z,1024)){if(Z>1024){alert(SPstringFormat(_spTr.pleaseDoNotSetLesser1024,Y))}else{alert(SPstringFormat(_spTr.pleaseDoNotSetLesserSize,Y,Y,Z))}aa.preventDefault();ab.focus()}else{this.defaultValue=ab.val()}});jQuery(".shortpixel-confirm").click(function(Z){var Y=confirm(Z.target.getAttribute("data-confirm"));if(!Y){Z.preventDefault();return false}return true});jQuery('input[name="removeExif"], input[name="png2jpg"]').on("change",function(){ShortPixel.checkExifWarning()});ShortPixel.checkExifWarning()}function H(){jQuery(".wp-shortpixel-options .shortpixel-key-valid").css("display","none");jQuery(".wp-shortpixel-options button#validate").css("display","inline-block")}function y(){jQuery("input.remove-folder-button").click(function(){var W=jQuery(this).data("value");var V=confirm(SPstringFormat(_spTr.areYouSureStopOptimizing,W));if(V==true){jQuery("#removeFolder").val(W);jQuery("#wp_shortpixel_options").submit()}});jQuery("input.recheck-folder-button").click(function(){var W=jQuery(this).data("value");var V=confirm(SPstringFormat(_spTr.areYouSureStopOptimizing,W));if(V==true){jQuery("#recheckFolder").val(W);jQuery("#wp_shortpixel_options").submit()}})}function P(V){var W=jQuery("#"+(V.checked?"total":"main")+"ToProcess").val();jQuery("div.bulk-play span.total").text(W);jQuery("#displayTotal").text(W)}function g(){ShortPixel.adjustSettingsTabs();ShortPixel.setupGeneralTab();jQuery(window).resize(function(){ShortPixel.adjustSettingsTabs()});jQuery("article.sp-tabs a.tab-link").click(function(W){var V=jQuery(W.target).data("id");ShortPixel.switchSettingsTab(V)});jQuery("input[type=radio][name=deliverWebpType]").change(function(){if(this.value=="deliverWebpAltered"){if(window.confirm(_spTr.alertDeliverWebPAltered)){var V=jQuery("input[type=radio][name=deliverWebpAlteringType]:checked").length;if(V==0){jQuery("#deliverWebpAlteredWP").prop("checked",true)}}else{jQuery(this).prop("checked",false)}}else{if(this.value=="deliverWebpUnaltered"){window.alert(_spTr.alertDeliverWebPUnaltered)}}})}function C(aa){var X=aa.replace("tab-",""),V="",Z=jQuery("section#"+aa);jQuery('input[name="display_part"]').val(X);var Y=window.location.href.toString();if(Y.indexOf("?")>0){var W=Y.substring(0,Y.indexOf("?"));W+="?"+jQuery.param({page:"wp-shortpixel-settings",part:X});window.history.replaceState({},document.title,W)}if(Z.length>0){jQuery("section").removeClass("sel-tab");jQuery("section .wp-shortpixel-tab-content").fadeOut(50);jQuery(Z).addClass("sel-tab");ShortPixel.adjustSettingsTabs();jQuery(Z).find(".wp-shortpixel-tab-content").fadeIn(50)}if(typeof HS!=="undefined"&&typeof HS.beacon.suggest!=="undefined"){switch(X){case"settings":V=shortpixel_suggestions_settings;break;case"adv-settings":V=shortpixel_suggestions_adv_settings;break;case"cloudflare":case"stats":V=shortpixel_suggestions_cloudflare;break;default:break}HS.beacon.suggest(V)}}function D(){var V=jQuery("section.sel-tab").height()+90;jQuery(".section-wrapper").css("height",V)}function R(){var V={action:"shortpixel_dismiss_media_alert"};jQuery.get(ShortPixel.AJAX_URL,V,function(W){V=JSON.parse(W);if(V.Status=="success"){jQuery("#short-pixel-media-alert").hide()}})}function w(){jQuery("#shortpixel-hs-button-blind").remove();jQuery("#shortpixel-hs-tools").remove();jQuery("#hs-beacon").remove();jQuery("#botbutton").remove();jQuery("#shortpixel-hs-blind").remove()}function q(){w();dismissShortPixelNotice("help")}function m(){var V={action:"shortpixel_check_quota"};jQuery.get(ShortPixel.AJAX_URL,V,function(){console.log("quota refreshed")})}function G(V){if(V.checked){jQuery("#with-thumbs").css("display","inherit");jQuery("#without-thumbs").css("display","none")}else{jQuery("#without-thumbs").css("display","inherit");jQuery("#with-thumbs").css("display","none")}}function b(Z,X,W,Y,V){return(X>0?"<div class='sp-column-info'>"+_spTr.reducedBy+" <strong><span class='percent'>"+X+"%</span></strong> ":"")+(X>0&&X<5?"<br>":"")+(X<5?_spTr.bonusProcessing:"")+(W.length>0?" ("+W+")":"")+(0+Y>0?"<br>"+SPstringFormat(_spTr.plusXthumbsOpt,Y):"")+(0+V>0?"<br>"+SPstringFormat(_spTr.plusXretinasOpt,V):"")+"</div>"}function s(W,V){jQuery(W).knob({readOnly:true,width:V,height:V,fgColor:"#1CAECB",format:function(X){return X+"%"}})}function c(ac,X,aa,Z,W,ab){if(W==1){var Y=jQuery(".sp-column-actions-template").clone();if(!Y.length){return false}var V;if(X.length==0){V=["lossy","lossless"]}else{V=["lossy","glossy","lossless"].filter(function(ad){return !(ad==X)})}Y.html(Y.html().replace(/__SP_ID__/g,ac));if(ab.substr(ab.lastIndexOf(".")+1).toLowerCase()=="pdf"){jQuery(".sp-action-compare",Y).remove()}if(aa==0&&Z>0){Y.html(Y.html().replace("__SP_THUMBS_TOTAL__",Z))}else{jQuery(".sp-action-optimize-thumbs",Y).remove();jQuery(".sp-dropbtn",Y).removeClass("button-primary")}Y.html(Y.html().replace(/__SP_FIRST_TYPE__/g,V[0]));Y.html(Y.html().replace(/__SP_SECOND_TYPE__/g,V[1]));return Y.html()}return""}function j(Z,Y){Z=Z.substring(2);if(jQuery(".shortpixel-other-media").length){var X=["optimize","retry","restore","redo","quota","view"];for(var W=0,V=X.length;W<V;W++){jQuery("#"+X[W]+"_"+Z).css("display","none")}for(var W=0,V=Y.length;W<V;W++){jQuery("#"+Y[W]+"_"+Z).css("display","")}}}function l(V){ShortPixel.retries++;if(isNaN(ShortPixel.retries)){ShortPixel.retries=1}if(ShortPixel.retries<6){console.log("Invalid response from server (Error: "+V+"). Retrying pass "+(ShortPixel.retries+1)+"...");setTimeout(checkBulkProgress,5000)}else{ShortPixel.bulkShowError(-1,"Invalid response from server received 6 times. Please retry later by reloading this page, or <a href='https://shortpixel.com/contact' target='_blank'>contact support</a>. (Error: "+V+")","");console.log("Invalid response from server 6 times. Giving up.")}}function n(V){V.action="shortpixel_browse_content";var W="";jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:V,success:function(X){W=X},async:false});return W}function d(){var V={action:"shortpixel_get_backup_size"};var W="";jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:V,success:function(X){W=X},async:false});return W}function f(W){if(!jQuery("#tos").is(":checked")){W.preventDefault();jQuery("#tos-robo").fadeIn(400,function(){jQuery("#tos-hand").fadeIn()});jQuery("#tos").click(function(){jQuery("#tos-robo").css("display","none");jQuery("#tos-hand").css("display","none")});return}jQuery("#request_key").addClass("disabled");jQuery("#pluginemail_spinner").addClass("is-active");ShortPixel.updateSignupEmail();if(ShortPixel.isEmailValid(jQuery("#pluginemail").val())){jQuery("#pluginemail-error").css("display","none");var V={action:"shortpixel_new_api_key",email:jQuery("#pluginemail").val()};jQuery.ajax({type:"POST",async:false,url:ShortPixel.AJAX_URL,data:V,success:function(X){data=JSON.parse(X);if(data.Status=="success"){W.preventDefault();window.location.reload()}else{if(data.Status=="invalid"){jQuery("#pluginemail-error").html("<b>"+data.Details+"</b>");jQuery("#pluginemail-error").css("display","");jQuery("#pluginemail-info").css("display","none");W.preventDefault()}else{}}}});jQuery("#request_key").removeAttr("onclick")}else{jQuery("#pluginemail-error").css("display","");jQuery("#pluginemail-info").css("display","none");W.preventDefault()}jQuery("#request_key").removeClass("disabled");jQuery("#pluginemail_spinner").removeClass("is-active")}function S(){jQuery("#shortPixelProposeUpgrade .sp-modal-body").addClass("sptw-modal-spinner");jQuery("#shortPixelProposeUpgrade .sp-modal-body").html("");jQuery("#shortPixelProposeUpgradeShade").css("display","block");jQuery("#shortPixelProposeUpgrade").removeClass("shortpixel-hide");var V={action:"shortpixel_propose_upgrade"};jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:V,success:function(W){jQuery("#shortPixelProposeUpgrade .sp-modal-body").removeClass("sptw-modal-spinner");jQuery("#shortPixelProposeUpgrade .sp-modal-body").html(W)}})}function L(){jQuery("#shortPixelProposeUpgradeShade").css("display","none");jQuery("#shortPixelProposeUpgrade").addClass("shortpixel-hide");if(ShortPixel.toRefresh){ShortPixel.recheckQuota()}}function z(){jQuery("#short-pixel-notice-unlisted").hide();jQuery("#optimizeUnlisted").prop("checked",true);var V={action:"shortpixel_dismiss_notice",notice_id:"unlisted",notice_data:"true"};jQuery.get(ShortPixel.AJAX_URL,V,function(W){V=JSON.parse(W);if(V.Status==ShortPixel.STATUS_SUCCESS){console.log("dismissed")}})}function r(){jQuery(".select-folder-button").click(function(){jQuery(".sp-folder-picker-shade").fadeIn(100);jQuery(".shortpixel-modal.modal-folder-picker").show();var V=jQuery(".sp-folder-picker");V.parent().css("margin-left",-V.width()/2);V.fileTree({script:ShortPixel.browseContent,multiFolder:false})});jQuery(".shortpixel-modal input.select-folder-cancel, .sp-folder-picker-shade").click(function(){jQuery(".sp-folder-picker-shade").fadeOut(100);jQuery(".shortpixel-modal.modal-folder-picker").hide()});jQuery(".shortpixel-modal input.select-folder").click(function(Y){var X=jQuery("UL.jqueryFileTree LI.directory.selected");if(jQuery(X).length==0){var X=jQuery("UL.jqueryFileTree LI.selected").parents(".directory")}var V=jQuery(X).children("a").attr("rel");if(typeof V==="undefined"){return}V=V.trim();if(V){var W=jQuery("#customFolderBase").val()+V;if(W.slice(-1)=="/"){W=W.slice(0,-1)}jQuery("#addCustomFolder").val(W);jQuery("#addCustomFolderView").val(W);jQuery(".sp-folder-picker-shade").fadeOut(100);jQuery(".shortpixel-modal.modal-folder-picker").css("display","none");jQuery("#saveAdvAddFolder").removeClass("hidden")}else{alert("Please select a folder from the list.")}})}function K(Z,Y,X){var W=jQuery(".bulk-notice-msg.bulk-lengthy");if(W.length==0){return}var V=jQuery("a",W);V.text(Y);if(X){V.attr("href",X)}else{V.attr("href",V.data("href").replace("__ID__",Z))}W.css("display","block")}function F(){jQuery(".bulk-notice-msg.bulk-lengthy").css("display","none")}function A(V){var W=jQuery(".bulk-notice-msg.bulk-"+V);if(W.length==0){return}W.css("display","block")}function T(V){jQuery(".bulk-notice-msg.bulk-"+V).css("display","none")}function v(ab,Z,aa,Y){var V=jQuery("#bulk-error-template");if(V.length==0){return}var X=V.clone();X.attr("id","bulk-error-"+ab);if(ab==-1){jQuery("span.sp-err-title",X).remove();X.addClass("bulk-error-fatal")}else{jQuery("img",X).remove();jQuery("#bulk-error-".id).remove()}jQuery("span.sp-err-content",X).html(Z);var W=jQuery("a.sp-post-link",X);if(Y){W.attr("href",Y)}else{W.attr("href",W.attr("href").replace("__ID__",ab))}W.text(aa);V.after(X);X.css("display","block")}function I(V,W){if(!confirm(_spTr["confirmBulk"+V])){W.stopPropagation();W.preventDefault();return false}return true}function B(Y){var W=jQuery(Y.target).val();var V=jQuery('input[name="random_answer"]').val();var X=jQuery('input[name="random_answer"]').data("target");if(W==V){jQuery(X).removeClass("disabled").prop("disabled",false);jQuery(X).removeAttr("aria-disabled")}else{jQuery(X).addClass("disabled").prop("disabled",true)}}function u(V){jQuery(V).parent().parent().remove()}function M(V){return V.substring(0,2)=="C-"}function O(){var V=window.location.href.split("#");window.location.href=V[0]+(V[0].indexOf("?")>0?"&":"?")+"checkquota=1"+(typeof V[1]==="undefined"?"":"#"+V[1])}function h(W){W.preventDefault();if(!this.menuCloseEvent){jQuery(window).click(function(X){if(!X.target.matches(".sp-dropbtn")){jQuery(".sp-dropdown.sp-show").removeClass("sp-show")}});this.menuCloseEvent=true}var V=W.target.parentElement.classList.contains("sp-show");jQuery(".sp-dropdown.sp-show").removeClass("sp-show");if(!V){W.target.parentElement.classList.add("sp-show")}}function U(V){this.comparerData.origUrl=false;if(this.comparerData.cssLoaded===false){jQuery("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:this.WP_PLUGIN_URL+"/res/css/twentytwenty.min.css"});this.comparerData.cssLoaded=2}if(this.comparerData.jsLoaded===false){jQuery.getScript(this.WP_PLUGIN_URL+"/res/js/jquery.twentytwenty.min.js",function(){ShortPixel.comparerData.jsLoaded=2;if(ShortPixel.comparerData.origUrl.length>0){ShortPixel.displayComparerPopup(ShortPixel.comparerData.width,ShortPixel.comparerData.height,ShortPixel.comparerData.origUrl,ShortPixel.comparerData.optUrl)}});this.comparerData.jsLoaded=1}if(this.comparerData.origUrl===false){jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:{action:"shortpixel_get_comparer_data",id:V},success:function(W){data=JSON.parse(W);jQuery.extend(ShortPixel.comparerData,data);if(ShortPixel.comparerData.jsLoaded==2){ShortPixel.displayComparerPopup(ShortPixel.comparerData.width,ShortPixel.comparerData.height,ShortPixel.comparerData.origUrl,ShortPixel.comparerData.optUrl)}}});this.comparerData.origUrl=""}}function J(X,ad,ae,Y){var ac=X;var W=(ad<150||X<350);var ab=jQuery(W?"#spUploadCompareSideBySide":"#spUploadCompare");var Z=jQuery(".sp-modal-shade");if(!W){jQuery("#spCompareSlider").html('<img class="spUploadCompareOriginal"/><img class="spUploadCompareOptimized"/>')}X=Math.max(350,Math.min(800,(X<350?(X+25)*2:(ad<150?X+25:X))));ad=Math.max(150,(W?(ac>350?2*(ad+45):ad+45):ad*X/ac));var aa="-"+Math.round(X/2);jQuery(".sp-modal-body",ab).css("width",X);jQuery(".shortpixel-slider",ab).css("width",X);ab.css("width",X);ab.css("marginLeft",aa+"px");jQuery(".sp-modal-body",ab).css("height",ad);ab.show();Z.show();if(!W){jQuery("#spCompareSlider").twentytwenty({slider_move:"mousemove"})}jQuery(".sp-close-button").on("click",ShortPixel.closeComparerPopup);jQuery(document).on("keyup.sp_modal_active",ShortPixel.closeComparerPopup);jQuery(".sp-modal-shade").on("click",ShortPixel.closeComparerPopup);var V=jQuery(".spUploadCompareOptimized",ab);jQuery(".spUploadCompareOriginal",ab).attr("src",ae);setTimeout(function(){jQuery(window).trigger("resize")},1000);V.load(function(){jQuery(window).trigger("resize")});V.attr("src",Y)}function t(V){jQuery("#spUploadCompareSideBySide").hide();jQuery("#spUploadCompare").hide();jQuery(".sp-modal-shade").hide();jQuery(document).unbind("keyup.sp_modal_active");jQuery(".sp-modal-shade").off("click");jQuery(".sp-close-button").off("click")}function E(V){var W=document.createElement("a");W.href=V;if(V.indexOf(W.protocol+"//"+W.hostname)<0){return W.href}return V.replace(W.protocol+"//"+W.hostname,W.protocol+"//"+W.hostname.split(".").map(function(X){return sp_punycode.toASCII(X)}).join("."))}return{init:N,setOptions:o,isEmailValid:x,updateSignupEmail:p,validateKey:a,enableResize:Q,setupGeneralTab:e,apiKeyChanged:H,setupAdvancedTab:y,checkThumbsUpdTotal:P,initSettings:g,switchSettingsTab:C,adjustSettingsTabs:D,onBulkThumbsCheck:G,dismissMediaAlert:R,closeHelpPane:w,dismissHelpPane:q,checkQuota:m,percentDial:s,successMsg:b,successActions:c,otherMediaUpdateActions:j,retry:l,initFolderSelector:r,browseContent:n,getBackupSize:d,newApiKey:f,proposeUpgrade:S,closeProposeUpgrade:L,includeUnlisted:z,bulkShowLengthyMsg:K,bulkHideLengthyMsg:F,bulkShowMaintenanceMsg:A,bulkHideMaintenanceMsg:T,bulkShowError:v,confirmBulkAction:I,checkRandomAnswer:B,removeBulkMsg:u,isCustomImageId:M,recheckQuota:O,openImageMenu:h,menuCloseEvent:false,loadComparer:U,displayComparerPopup:J,closeComparerPopup:t,convertPunycode:E,checkExifWarning:k,comparerData:{cssLoaded:false,jsLoaded:false,origUrl:false,optUrl:false,width:0,height:0},toRefresh:false,resizeSizesAlert:false,returnedStatusSearching:0}}();function showToolBarAlert(c,b,d){var a=jQuery("li.shortpixel-toolbar-processing");switch(c){case ShortPixel.STATUS_QUOTA_EXCEEDED:if(window.location.href.search("wp-short-pixel-bulk")>0&&jQuery(".sp-quota-exceeded-alert").length==0){location.reload();return}a.addClass("shortpixel-alert");a.addClass("shortpixel-quota-exceeded");jQuery("a",a).attr("href","options-general.php?page=wp-shortpixel-settings");jQuery("a div",a).attr("title","ShortPixel quota exceeded. Click for details.");break;case ShortPixel.STATUS_SKIP:case ShortPixel.STATUS_FAIL:a.addClass("shortpixel-alert shortpixel-processing");jQuery("a div",a).attr("title",b);if(typeof d!=="undefined"){jQuery("a",a).attr("href","post.php?post="+d+"&action=edit")}break;case ShortPixel.STATUS_NO_KEY:a.addClass("shortpixel-alert");a.addClass("shortpixel-quota-exceeded");jQuery("a",a).attr("href","options-general.php?page=wp-shortpixel-settings");jQuery("a div",a).attr("title","Get API Key");break;case ShortPixel.STATUS_SUCCESS:case ShortPixel.STATUS_RETRY:a.addClass("shortpixel-processing");a.removeClass("shortpixel-alert");jQuery("a",a).removeAttr("target");jQuery("a",a).attr("href",jQuery("a img",a).attr("success-url"))}a.removeClass("shortpixel-hide")}function hideToolBarAlert(){jQuery("li.shortpixel-toolbar-processing.shortpixel-processing").addClass("shortpixel-hide")}function hideQuotaExceededToolBarAlert(){jQuery("li.shortpixel-toolbar-processing.shortpixel-quota-exceeded").addClass("shortpixel-hide")}function checkQuotaExceededAlert(){if(typeof shortPixelQuotaExceeded!="undefined"){if(shortPixelQuotaExceeded==1){showToolBarAlert(ShortPixel.STATUS_QUOTA_EXCEEDED)}else{hideQuotaExceededToolBarAlert()}}}function checkBulkProgress(){var b=function(e){if(!d){d=true;return e}return"/"};var d=false;var a=window.location.href.toLowerCase().replace(/\/\//g,b);d=false;var c=ShortPixel.WP_ADMIN_URL.toLowerCase().replace(/\/\//g,b);if(a.search(c)<0){a=ShortPixel.convertPunycode(a);c=ShortPixel.convertPunycode(c)}if(a.search(c+"upload.php")<0&&a.search(c+"edit.php")<0&&a.search(c+"edit-tags.php")<0&&a.search(c+"post-new.php")<0&&a.search(c+"post.php")<0&&a.search("page=nggallery-manage-gallery")<0&&(ShortPixel.FRONT_BOOTSTRAP==0||a.search(c)==0)){hideToolBarAlert();return}if(ShortPixel.bulkProcessor==true&&window.location.href.search("wp-short-pixel-bulk")<0&&typeof localStorage.bulkPage!=="undefined"&&localStorage.bulkPage>0){ShortPixel.bulkProcessor=false}if(window.location.href.search("wp-short-pixel-bulk")>=0){ShortPixel.bulkProcessor=true;localStorage.bulkTime=Math.floor(Date.now()/1000);localStorage.bulkPage=1}if(ShortPixel.bulkProcessor==true||typeof localStorage.bulkTime=="undefined"||Math.floor(Date.now()/1000)-localStorage.bulkTime>90){ShortPixel.bulkProcessor=true;localStorage.bulkPage=(window.location.href.search("wp-short-pixel-bulk")>=0?1:0);localStorage.bulkTime=Math.floor(Date.now()/1000);console.log(localStorage.bulkTime);checkBulkProcessingCallApi()}else{setTimeout(checkBulkProgress,5000)}}function checkBulkProcessingCallApi(){var a={action:"shortpixel_image_processing"};jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:a,success:function(g){if(g.length>0){var j=null;try{var j=JSON.parse(g)}catch(l){ShortPixel.retry(l.message);return}ShortPixel.retries=0;var d=j.ImageID;var k=(jQuery("div.short-pixel-bulk-page").length>0);if(j.Status&&j.Status!=ShortPixel.STATUS_SEARCHING){if(ShortPixel.returnedStatusSearching>=2){jQuery(".bulk-notice-msg.bulk-searching").hide()}ShortPixel.returnedStatusSearching=0}switch(j.Status){case ShortPixel.STATUS_NO_KEY:setCellMessage(d,j.Message,"<a class='button button-smaller button-primary' href=\"https://shortpixel.com/wp-apikey"+ShortPixel.AFFILIATE+'" target="_blank">'+_spTr.getApiKey+"</a>");showToolBarAlert(ShortPixel.STATUS_NO_KEY);break;case ShortPixel.STATUS_QUOTA_EXCEEDED:setCellMessage(d,j.Message,"<a class='button button-smaller button-primary' href=\"https://shortpixel.com/login/"+ShortPixel.API_KEY+'" target="_blank">'+_spTr.extendQuota+"</a><a class='button button-smaller' href='admin.php?action=shortpixel_check_quota'>"+_spTr.check__Quota+"</a>");showToolBarAlert(ShortPixel.STATUS_QUOTA_EXCEEDED);if(j.Stop==false){setTimeout(checkBulkProgress,5000)}ShortPixel.otherMediaUpdateActions(d,["quota","view"]);break;case ShortPixel.STATUS_FAIL:setCellMessage(d,j.Message,"<a class='button button-smaller button-primary' href=\"javascript:manualOptimization('"+d+"', false)\">"+_spTr.retry+"</a>");showToolBarAlert(ShortPixel.STATUS_FAIL,j.Message,d);if(k){ShortPixel.bulkShowError(d,j.Message,j.Filename,j.CustomImageLink);if(j.BulkPercent){progressUpdate(j.BulkPercent,j.BulkMsg)}ShortPixel.otherMediaUpdateActions(d,["retry","view"])}console.log(j.Message);setTimeout(checkBulkProgress,5000);break;case ShortPixel.STATUS_EMPTY_QUEUE:console.log(j.Message);clearBulkProcessor();hideToolBarAlert();var c=jQuery("#bulk-progress");if(k&&c.length&&j.BulkStatus!="2"){progressUpdate(100,"Bulk finished!");jQuery("a.bulk-cancel").attr("disabled","disabled");hideSlider();setTimeout(function(){window.location.reload()},3000)}break;case ShortPixel.STATUS_SUCCESS:if(k){ShortPixel.bulkHideLengthyMsg();ShortPixel.bulkHideMaintenanceMsg()}var m=j.PercentImprovement;showToolBarAlert(ShortPixel.STATUS_SUCCESS,"");var b=ShortPixel.isCustomImageId(d)?"":ShortPixel.successActions(d,j.Type,j.ThumbsCount,j.ThumbsTotal,j.BackupEnabled,j.Filename);setCellMessage(d,ShortPixel.successMsg(d,m,j.Type,j.ThumbsCount,j.RetinasCount),b);if(jQuery("#post-"+d).length>0){jQuery("#post-"+d).find(".filename").text(j.Filename)}if(jQuery(".misc-pub-filename strong").length>0){jQuery(".misc-pub-filename strong").text(j.Filename)}if(ShortPixel.isCustomImageId(d)&&j.TsOptimized&&j.TsOptimized.length>0){console.log(d);jQuery(".date-"+d).text(j.TsOptimized)}var h=jQuery(["restore","view","redolossy","redoglossy","redolossless"]).not(["redo"+j.Type]).get();ShortPixel.otherMediaUpdateActions(d,h);var f=new PercentageAnimator("#sp-msg-"+d+" span.percent",m);f.animate(m);if(k&&typeof j.Thumb!=="undefined"){if(j.BulkPercent){progressUpdate(j.BulkPercent,j.BulkMsg)}if(j.Thumb.length>0){sliderUpdate(d,j.Thumb,j.BkThumb,j.PercentImprovement,j.Filename);if(typeof j.AverageCompression!=="undefined"&&0+j.AverageCompression>0){jQuery("#sp-avg-optimization").html('<input type="text" class="dial" value="'+Math.round(j.AverageCompression)+'"/>');ShortPixel.percentDial("#sp-avg-optimization .dial",60)}}}console.log("Server response: "+g);if(k&&typeof j.BulkPercent!=="undefined"){progressUpdate(j.BulkPercent,j.BulkMsg)}setTimeout(checkBulkProgress,5000);break;case ShortPixel.STATUS_SKIP:if(j.Silent!==1){ShortPixel.bulkShowError(d,j.Message,j.Filename,j.CustomImageLink)}case ShortPixel.STATUS_ERROR:if(typeof j.Message!=="undefined"){showToolBarAlert(ShortPixel.STATUS_SKIP,j.Message+" Image ID: "+d);setCellMessage(d,j.Message,"")}ShortPixel.otherMediaUpdateActions(d,["retry","view"]);case ShortPixel.STATUS_RETRY:console.log("Server response: "+g);showToolBarAlert(ShortPixel.STATUS_RETRY,"");if(k&&typeof j.BulkPercent!=="undefined"){progressUpdate(j.BulkPercent,j.BulkMsg)}if(k&&j.Count>3){ShortPixel.bulkShowLengthyMsg(d,j.Filename,j.CustomImageLink)}setTimeout(checkBulkProgress,5000);break;case ShortPixel.STATUS_SEARCHING:console.log("Server response: "+g);ShortPixel.returnedStatusSearching++;if(ShortPixel.returnedStatusSearching>=2){jQuery(".bulk-notice-msg.bulk-searching").show()}setTimeout(checkBulkProgress,2500);break;case ShortPixel.STATUS_MAINTENANCE:ShortPixel.bulkShowMaintenanceMsg("maintenance");setTimeout(checkBulkProgress,60000);break;case ShortPixel.STATUS_QUEUE_FULL:ShortPixel.bulkShowMaintenanceMsg("queue-full");setTimeout(checkBulkProgress,60000);break;default:ShortPixel.retry("Unknown status "+j.Status+". Retrying...");break}}},error:function(b){ShortPixel.retry(b.statusText)}})}function clearBulkProcessor(){ShortPixel.bulkProcessor=false;localStorage.bulkTime=0;if(window.location.href.search("wp-short-pixel-bulk")>=0){localStorage.bulkPage=0}}function setCellMessage(d,a,c){var b=jQuery("#sp-msg-"+d);if(b.length>0){b.html("<div class='sp-column-actions'>"+c+"</div><div class='sp-column-info'>"+a+"</div>");b.css("color","")}b=jQuery("#sp-cust-msg-"+d);if(b.length>0){b.html("<div class='sp-column-info'>"+a+"</div>")}}function manualOptimization(c,a){setCellMessage(c,"<img src='"+ShortPixel.WP_PLUGIN_URL+"/res/img/loading.gif' class='sp-loading-small'>Image waiting to be processed","");jQuery("li.shortpixel-toolbar-processing").removeClass("shortpixel-hide");jQuery("li.shortpixel-toolbar-processing").removeClass("shortpixel-alert");jQuery("li.shortpixel-toolbar-processing").addClass("shortpixel-processing");var b={action:"shortpixel_manual_optimization",image_id:c,cleanup:a};jQuery.ajax({type:"GET",url:ShortPixel.AJAX_URL,data:b,success:function(d){var e=JSON.parse(d);if(e.Status==ShortPixel.STATUS_SUCCESS){setTimeout(checkBulkProgress,2000)}else{setCellMessage(c,typeof e.Message!=="undefined"?e.Message:_spTr.thisContentNotProcessable,"")}},error:function(d){b.action="shortpixel_check_status";jQuery.ajax({type:"GET",url:ShortPixel.AJAX_URL,data:b,success:function(e){var f=JSON.parse(e);if(f.Status!==ShortPixel.STATUS_SUCCESS){setCellMessage(c,typeof f.Message!=="undefined"?f.Message:_spTr.thisContentNotProcessable,"")}}})}})}function reoptimize(c,a){setCellMessage(c,"<img src='"+ShortPixel.WP_PLUGIN_URL+"/res/img/loading.gif' class='sp-loading-small'>Image waiting to be reprocessed","");jQuery("li.shortpixel-toolbar-processing").removeClass("shortpixel-hide");jQuery("li.shortpixel-toolbar-processing").addClass("shortpixel-processing");var b={action:"shortpixel_redo",attachment_ID:c,type:a};jQuery.get(ShortPixel.AJAX_URL,b,function(d){b=JSON.parse(d);if(b.Status==ShortPixel.STATUS_SUCCESS){setTimeout(checkBulkProgress,2000)}else{$msg=typeof b.Message!=="undefined"?b.Message:_spTr.thisContentNotProcessable;setCellMessage(c,$msg,"");showToolBarAlert(ShortPixel.STATUS_FAIL,$msg)}})}function optimizeThumbs(b){setCellMessage(b,"<img src='"+ShortPixel.WP_PLUGIN_URL+"/res/img/loading.gif' class='sp-loading-small'>"+_spTr.imageWaitOptThumbs,"");jQuery("li.shortpixel-toolbar-processing").removeClass("shortpixel-hide");jQuery("li.shortpixel-toolbar-processing").addClass("shortpixel-processing");var a={action:"shortpixel_optimize_thumbs",attachment_ID:b};jQuery.get(ShortPixel.AJAX_URL,a,function(c){a=JSON.parse(c);if(a.Status==ShortPixel.STATUS_SUCCESS){setTimeout(checkBulkProgress,2000)}else{setCellMessage(b,typeof a.Message!=="undefined"?a.Message:_spTr.thisContentNotProcessable,"")}})}function dismissShortPixelNoticeExceed(b){jQuery("#wp-admin-bar-shortpixel_processing").hide();var a={action:"shortpixel_dismiss_notice",notice_id:"exceed"};jQuery.get(ShortPixel.AJAX_URL,a,function(c){a=JSON.parse(c);if(a.Status==ShortPixel.STATUS_SUCCESS){console.log("dismissed")}});b.preventDefault()}function dismissShortPixelNotice(b){jQuery("#short-pixel-notice-"+b).hide();var a={action:"shortpixel_dismiss_notice",notice_id:b};jQuery.get(ShortPixel.AJAX_URL,a,function(c){a=JSON.parse(c);if(a.Status==ShortPixel.STATUS_SUCCESS){console.log("dismissed")}})}function PercentageAnimator(b,a){this.animationSpeed=10;this.increment=2;this.curPercentage=0;this.targetPercentage=a;this.outputSelector=b;this.animate=function(c){this.targetPercentage=c;setTimeout(PercentageTimer.bind(null,this),this.animationSpeed)}}function PercentageTimer(a){if(a.curPercentage-a.targetPercentage<-a.increment){a.curPercentage+=a.increment}else{if(a.curPercentage-a.targetPercentage>a.increment){a.curPercentage-=a.increment}else{a.curPercentage=a.targetPercentage}}jQuery(a.outputSelector).text(a.curPercentage+"%");if(a.curPercentage!=a.targetPercentage){setTimeout(PercentageTimer.bind(null,a),a.animationSpeed)}}function progressUpdate(c,b){var a=jQuery("#bulk-progress");if(a.length){jQuery(".progress-left",a).css("width",c+"%");jQuery(".progress-img",a).css("left",c+"%");if(c>24){jQuery(".progress-img span",a).html("");jQuery(".progress-left",a).html(c+"%")}else{jQuery(".progress-img span",a).html(c+"%");jQuery(".progress-left",a).html("")}jQuery(".bulk-estimate").html(b)}}function sliderUpdate(g,c,d,e,b){var f=jQuery(".bulk-slider div.bulk-slide:first-child");if(f.length===0){return}if(f.attr("id")!="empty-slide"){f.hide()}f.css("z-index",1000);jQuery(".bulk-img-opt",f).attr("src","");if(typeof d==="undefined"){d=""}if(d.length>0){jQuery(".bulk-img-orig",f).attr("src","")}var a=f.clone();a.attr("id","slide-"+g);jQuery(".bulk-img-opt",a).attr("src",c);if(d.length>0){jQuery(".img-original",a).css("display","inline-block");jQuery(".bulk-img-orig",a).attr("src",d)}else{jQuery(".img-original",a).css("display","none")}jQuery(".bulk-opt-percent",a).html('<input type="text" class="dial" value="'+e+'"/>');jQuery(".bulk-slider").append(a);ShortPixel.percentDial("#"+a.attr("id")+" .dial",100);jQuery(".bulk-slider-container span.filename").html("&nbsp;&nbsp;"+b);if(f.attr("id")=="empty-slide"){f.remove();jQuery(".bulk-slider-container").css("display","block")}else{f.animate({left:f.width()+f.position().left},"slow","swing",function(){f.remove();a.fadeIn("slow")})}}function hideSlider(){jQuery(".bulk-slider-container").css("display","none")}function showStats(){var a=jQuery(".bulk-stats");if(a.length>0){}}function SPstringFormat(){var b=Array.prototype.slice.call(arguments);if(b.length===0){return}var a=b.shift();for(i=0;i<b.length;i++){a=a.replace(new RegExp("\\{"+i+"\\}","gm"),b[i])}return a};